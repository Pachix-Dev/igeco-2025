---
import i18next from 'i18next'

interface Props {
  images: Array<{
    image: string
    image_en: string
    alt: string
    link: string
  }>
}

const { images } = Astro.props
---

<div class='carousel h-48 sm:h-[350px] lg:h-[650px]' id='carousel'>
  {
    images.map((img, idx) => (
      <a
        href={img.link}
        target='_blank'
        rel='noopener noreferrer'
        class='carousel-link'
      >
        <img
          src={i18next.language === 'es' ? img.image : img.image_en}
          alt={img.alt}
          class={idx === 0 ? 'active' : ''}
        />
      </a>
    ))
  }
  <div class='carousel-controls'>
    <button class='carousel-btn' id='prev' aria-label='Imagen anterior'>
      <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <polyline points='15 18 9 12 15 6'></polyline>
      </svg>
    </button>
    <button class='carousel-btn' id='next' aria-label='Siguiente imagen'>
      <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <polyline points='9 18 15 12 9 6'></polyline>
      </svg>
    </button>
  </div>
</div>

<style>
  .carousel {
    position: relative;
    width: 100%;
    margin: auto;
    overflow: hidden;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  }
  .carousel img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.8s ease-in-out;
    z-index: 0;
  }
  .carousel img.active {
    opacity: 1;
    pointer-events: auto;
    z-index: 1;
  }
  .carousel-controls {
    position: absolute;
    width: 100%;
    top: 50%;
    display: flex;
    justify-content: space-between;
    transform: translateY(-50%);
    z-index: 2;
    padding: 0 1rem;
  }
  .carousel-btn {
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    border: none;
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(4px);
  }
  .carousel-btn:hover {
    background: rgba(0, 0, 0, 0.7);
    transform: scale(1.1);
  }
  .carousel-btn:active {
    transform: scale(0.95);
  }
  .carousel-btn svg {
    width: 1.5rem;
    height: 1.5rem;
  }

  @media (max-width: 640px) {
    .carousel-btn {
      width: 2.5rem;
      height: 2.5rem;
    }
    .carousel-btn svg {
      width: 1.25rem;
      height: 1.25rem;
    }
  }
</style>

<script type='module' is:inline>
  const images = document.querySelectorAll('#carousel img')
  let current = 0
  let interval = setInterval(nextImage, 3000)

  function showImage(idx) {
    images.forEach((img, i) => {
      img.classList.toggle('active', i === idx)
    })
  }

  function nextImage() {
    current = (current + 1) % images.length
    showImage(current)
  }

  function prevImage() {
    current = (current - 1 + images.length) % images.length
    showImage(current)
  }

  document.getElementById('next').onclick = () => {
    nextImage()
    resetInterval()
  }
  document.getElementById('prev').onclick = () => {
    prevImage()
    resetInterval()
  }

  function resetInterval() {
    clearInterval(interval)
    interval = setInterval(nextImage, 3000)
  }
</script>
